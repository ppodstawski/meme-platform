(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(5890)}])},5890:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return N}});var r=t(5893),s=t(9008),a=t.n(s),i=t(7294),c=t(7568),o=t(6042),u=t(9396),m=t(9815),d=t(4051),l=t.n(d),f=t(9367),h=t(7688),p=t(6877),x=t.n(p),g=t(6675),v=t(9631),j=t(4420),S=t(3474),I=t(4014),P=t(3749),y=function(e){var n,t=(0,v.Eu)().isLoggedIn,s=(0,i.useState)(!1),a=s[0],c=s[1],m=(0,i.useState)({result:"",message:""}),d=m[0],l=m[1];e.comments?n=e.comments.sort((function(e,n){return new Date(e.createdAt).getTime()-new Date(n.createdAt).getTime()})).map((function(n){if(n){var t={username:n.User?n.User.username:"Undefined user",profileImage:n.User.profileImage},s=(0,j.v)(n.createdAt);return(0,r.jsx)(I.Z,{id:n.id,memeId:e.id,creator:t,message:n.message,creationDate:s,showControls:!1},n.id)}})):n=(0,r.jsx)("span",{children:"No comments found"});return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsx)(S.Z,(0,u.Z)((0,o.Z)({},e),{showReactionButtons:!0})),(0,r.jsx)("section",{children:n}),a&&(0,r.jsx)("p",{children:"Loading comments..."}),!a&&t&&(0,r.jsx)(P.Z,{messageStateHandler:l,loadingStateHandler:c,memeId:e.id,action:"POST"}),!t&&(0,r.jsx)("p",{className:x().commentsLoginInfo,children:"You must log in to comment!"}),d.message&&(0,r.jsx)(g.Z,{result:d.result,message:d.message})]})},b=function(e){var n=(0,i.useState)([]),t=n[0],s=n[1],a=(0,i.useState)(!1),d=a[0],p=a[1],g=(0,i.useCallback)((0,c.Z)(l().mark((function e(){var n,t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.prev=1,e.next=4,fetch(h.ZP.URLS.API_POST+"/get-feed",{method:"GET",credentials:"include"});case 4:return n=e.sent,e.next=7,n.json();case 7:(t=e.sent).ok&&s((function(e){return(0,m.Z)(e).concat((0,m.Z)(t.body))})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.log(e.t0.message);case 14:return e.prev=14,p(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])}))),[]);return(0,i.useEffect)((function(){g();var e=(0,f.ZP)(h.ZP.URLS.APP);e.on("comments",(function(e){"add-comment"===e.action?s((function(n){var t=Array.from(n),r=e.comment.MemeId,s=t.find((function(e){return e.id===r}));return s?(s.comments.push(e.comment),t):n})):"update-comment"===e.action?s((function(n){var t=Array.from(n),r=e.comment.MemeId,s=t.find((function(e){return e.id===r}));if(s){var a=s.comments.findIndex((function(n){return n.id===e.comment.id})),i=(0,u.Z)((0,o.Z)({},s.comments[a]),{message:e.comment.message});return s.comments.splice(a,1,i),t}return n})):"delete-comment"===e.action&&s((function(n){var t=Array.from(n),r=e.comment.MemeId,s=t.find((function(e){return e.id===r}));if(s){var a=s.comments.findIndex((function(n){return n.id===e.comment.id}));return s.comments.splice(a,1),t}return n}))})),e.on("reactions",(function(e){"add-reaction"===e.action&&s((function(n){var t=Array.from(n),r=e.reaction.memeId,s=t.find((function(e){return e.id===r}));if(s){var a=s.reactions.findIndex((function(n){return n.type===e.reaction.type}));return-1!==a?s.reactions[a].Users.push({id:e.user.id,username:e.user.username}):s.reactions.push({id:e.reaction.id,type:e.reaction.type,MemeId:e.reaction.memeId,Users:[{id:e.user.id,username:e.user.username}]}),t}return n})),"remove-reaction"===e.action&&s((function(n){var t=Array.from(n),r=e.reaction.memeId,s=t.find((function(e){return e.id===r}));return s?(s.reactions.forEach((function(n){var t=n.Users.findIndex((function(n){return n.id===e.user.id}));-1!==t&&n.Users.splice(t,1)})),t):n}))}))}),[g]),(0,r.jsxs)(i.Fragment,{children:[d&&(0,r.jsx)("p",{children:"Loading memes..."}),!d&&(0,r.jsx)("section",{children:t.length>0?(0,r.jsx)("ul",{children:t.map((function(e){return(0,r.jsx)("li",{className:x().feedItem+" commonCard",children:(0,r.jsx)(y,(0,o.Z)({},e))},e.id)}))}):(0,r.jsx)("div",{className:"commonCard",children:"Ups! We got error! No memes found!"})})]})},N=function(){return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)(a(),{children:[(0,r.jsx)("title",{children:"Meme Platform"}),(0,r.jsx)("meta",{name:"description",content:"Meme Platform"})]}),(0,r.jsx)(b,{})]})}},4014:function(e,n,t){"use strict";var r=t(7568),s=t(4051),a=t.n(s),i=t(5893),c=t(7294),o=t(7688),u=t(6642),m=t(6675),d=t(3749);n.Z=function(e){var n=(0,c.useState)(!1),t=n[0],s=n[1],l=(0,c.useState)(!1),f=l[0],h=l[1],p=(0,c.useState)(e.message),x=p[0],g=p[1],v=(0,c.useState)({result:"",message:""}),j=v[0],S=v[1],I=function(){var n=(0,r.Z)(a().mark((function n(){var t;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return h(!0),n.prev=1,n.next=4,fetch(o.ZP.URLS.API_POST+"/delete-comment",{method:"DELETE",credentials:"include",body:JSON.stringify({commentId:e.id}),headers:{"Content-Type":"application/json"}});case 4:return t=n.sent,n.next=7,t.json();case 7:n.sent.ok&&e.removeHandler&&e.removeHandler(e.id),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(1),console.log(n.t0.message);case 14:return n.prev=14,h(!1),n.finish(14);case 17:case"end":return n.stop()}}),n,null,[[1,11,14,17]])})));return function(){return n.apply(this,arguments)}}();(0,c.useEffect)((function(){g(e.message)}),[e.message]);var P=e.showControls?" controls":"",y=e.hideProfilePicture?" hideProfilePicture":"";return(0,i.jsxs)(c.Fragment,{children:[f&&(0,i.jsx)("div",{children:"Loading..."}),(0,i.jsxs)("div",{className:"commentField"+P+y,children:[!f&&!t&&(0,i.jsxs)(c.Fragment,{children:[(0,i.jsxs)("p",{children:[!e.hideProfilePicture&&(0,i.jsx)(u.Z,{src:e.creator.profileImage,alt:e.creator.username,place:"COMMENTS"}),(0,i.jsxs)("b",{children:[e.creator.username,":"]})," ",x]}),(0,i.jsx)("time",{children:e.creationDate})]}),!f&&t&&(0,i.jsx)(d.Z,{messageStateHandler:S,loadingStateHandler:h,memeId:e.memeId,commentId:e.id,action:"UPDATE",filledMessage:x,onUpdateHandler:function(e){g(e),s(!1)}}),t&&j.message&&(0,i.jsx)(m.Z,{result:j.result,message:j.message}),e.showControls&&(0,i.jsxs)("div",{className:"commentControls",children:[(0,i.jsx)("button",{onClick:function(){s((function(e){return!e}))},className:t?"actionButton editing":"actionButton",children:t?"Stop editing":"Edit"}),(0,i.jsx)("button",{onClick:I,className:"actionButton",children:"Delete"})]})]})]})}},3749:function(e,n,t){"use strict";var r=t(7568),s=t(6042),a=t(4051),i=t.n(a),c=t(5893),o=t(7294),u=t(7688);n.Z=function(e){var n=(0,o.useRef)(),t=(0,o.useState)(e.filledMessage?e.filledMessage:""),a=t[0],m=t[1],d=function(){var n=(0,r.Z)(i().mark((function n(t){var r,c,o,m,d;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),!(a.length>0)){n.next=27;break}return e.loadingStateHandler(!0),n.prev=3,r=u.ZP.URLS.API_POST+"/post-comment",c="POST","UPDATE"===e.action&&(r=u.ZP.URLS.API_POST+"/update-comment",c="PATCH"),o={memeId:e.memeId,message:a},e.commentId&&(o.commentId=e.commentId),n.next=11,fetch(r,{method:c,credentials:"include",body:JSON.stringify((0,s.Z)({},o)),headers:{"Content-Type":"application/json"}});case 11:return m=n.sent,n.next=14,m.json();case 14:!(d=n.sent).ok&&d.flash&&e.messageStateHandler(d.flash),d.ok&&e.onUpdateHandler&&e.onUpdateHandler(a),n.next=22;break;case 19:n.prev=19,n.t0=n.catch(3),console.log(n.t0.message);case 22:return n.prev=22,e.loadingStateHandler(!1),n.finish(22);case 25:n.next=28;break;case 27:e.messageStateHandler({result:"error",message:"Please provide some message if you want to comment."});case 28:case"end":return n.stop()}}),n,null,[[3,19,22,25]])})));return function(e){return n.apply(this,arguments)}}();return(0,c.jsx)(o.Fragment,{children:(0,c.jsx)("div",{className:"comments",children:(0,c.jsxs)("form",{onSubmit:d,children:[(0,c.jsx)("input",{type:"hidden",ref:n,value:e.memeId}),(0,c.jsx)("input",{type:"text",onChange:function(e){m(e.target.value)},placeholder:"Type your comment here",value:a}),(0,c.jsx)("button",{children:"Submit comment"})]})})})}},3474:function(e,n,t){"use strict";t.d(n,{Z:function(){return j}});var r=t(5893),s=t(7294),a=t(4420),i=t(7568),c=t(4051),o=t.n(c),u=t(9631),m=t(7688),d=t(4502),l=function(e){var n=function(){var n=(0,i.Z)(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.isButtonActive){n.next=2;break}return n.abrupt("return");case 2:return e.setStateForLoading(!0),n.prev=3,n.next=6,fetch(m.ZP.URLS.API_POST+"/add-reaction",{method:"POST",credentials:"include",body:JSON.stringify({type:e.emoji.number,memeId:e.memeId}),headers:{"Content-Type":"application/json"}});case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(3),console.log(n.t0.message);case 11:return n.prev=11,e.setStateForLoading(!1),n.finish(11);case 14:case"end":return n.stop()}}),n,null,[[3,8,11,14]])})));return function(){return n.apply(this,arguments)}}(),t=0===e.numberOfReactions?" dimItem":"",s=e.isButtonActive?" active":" inactive",a=e.chosenType===e.emoji.number?" isChosen":"";return(0,r.jsxs)("span",{className:"reactionIcon"+t,children:[(0,r.jsx)("img",{src:"/images/cheese-emojis/emoji-"+e.emoji.name+".png",alt:e.emoji.name,onClick:n,className:s}),(0,r.jsx)("b",{className:a,children:e.numberOfReactions})]})},f=t(3829),h=t.n(f),p=function(e){var n=(0,u.Eu)(),t=n.user.userId,a=n.isLoggedIn,c=(0,s.useState)(!1),f=c[0],p=c[1],x=(0,s.useState)(!1),g=x[0],v=x[1],j=(0,s.useState)(0),S=j[0],I=j[1],P=e.showReactionButtons,y=function(){var n=(0,i.Z)(o().mark((function n(){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return p(!0),n.prev=1,n.next=4,fetch(m.ZP.URLS.API_POST+"/remove-reaction",{method:"DELETE",credentials:"include",body:JSON.stringify({memeId:e.memeId}),headers:{"Content-Type":"application/json"}});case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(1),console.log(n.t0.message);case 9:return n.prev=9,p(!1),n.finish(9);case 12:case"end":return n.stop()}}),n,null,[[1,6,9,12]])})));return function(){return n.apply(this,arguments)}}(),b=function(){var n=!1,r=0;e.reactions.forEach((function(e){e.Users.find((function(e){return e.id===t}))&&(r=e.type,n=!0)})),I(r),v(n)};(0,s.useEffect)((function(){b()}),[b]);var N=function(n){var t=e.reactions.find((function(e){return e.type===n}));return t?t.Users.flat().length:0};return(0,r.jsxs)("div",{className:h().reactionPanel,children:[P&&(g?(0,r.jsxs)(s.Fragment,{children:[(0,r.jsx)("button",{className:"reactBtn remove",onClick:y,children:"Remove reaction"}),(0,r.jsx)("span",{className:"reactInfo",children:"You reacted already!"})]}):a?(0,r.jsxs)("button",{className:"reactBtn inactive",disabled:!0,children:["Here you can react ",(0,r.jsx)(d.Z,{src:"right-arrow-alt",alt:"Arrow right"})]}):(0,r.jsx)("button",{className:"reactBtn inactive",disabled:!0,children:"Need to login to react!"})),f&&(0,r.jsx)("span",{children:"Loading reactions..."}),!f&&(0,r.jsx)("span",{children:m.Ax.map((function(n){return(0,r.jsx)(l,{emoji:n,numberOfReactions:N(n.number),setStateForLoading:p,memeId:e.memeId,isButtonActive:P&&a&&!g,chosenType:S})}))})]})},x=t(8524),g=t.n(x),v=function(e){return(0,r.jsxs)("span",{className:g().reactionSumStar,children:[(0,r.jsx)("b",{children:e.reactions.map((function(e){return e.Users})).flat().length}),(0,r.jsx)("img",{src:"/images/star.png",alt:"Star for number of reactions"})]})},j=function(e){var n=(0,a.v)(e.createdAt);return(0,r.jsxs)("article",{className:"feedItemContent",children:[(0,r.jsxs)("header",{children:[(0,r.jsx)("h3",{children:e.title}),(0,r.jsxs)("p",{children:["by: ",(0,r.jsx)("i",{children:e.User.username}),", at: ",(0,r.jsx)("time",{children:n})]})]}),(0,r.jsx)("section",{children:e.description}),(0,r.jsxs)("figure",{children:[(0,r.jsx)(v,{reactions:e.reactions}),(0,r.jsx)("img",{src:e.imageUrl,alt:e.title})]}),(0,r.jsx)(p,{reactions:e.reactions,memeId:e.id,showReactionButtons:e.showReactionButtons})]})}},6675:function(e,n,t){"use strict";var r=t(5893),s=(t(7294),t(9537)),a=t.n(s);n.Z=function(e){return(0,r.jsx)("div",{className:a().flashMessage,children:(0,r.jsx)("span",{className:"messageText "+e.result+"Msg",children:e.message})})}},4420:function(e,n,t){"use strict";t.d(n,{v:function(){return r}});var r=function(e){return new Date(e).toLocaleString("en-GB",{timeZone:"UTC"})}},6877:function(e){e.exports={feedItem:"Feed_feedItem__Aiwxo",commentsLoginInfo:"Feed_commentsLoginInfo__i4Vkp"}},9537:function(e){e.exports={flashMessage:"FlashMessage_flashMessage__2D1Ek"}},3829:function(e){e.exports={reactionPanel:"ReactionPanel_reactionPanel__cNIgz"}},8524:function(e){e.exports={reactionSumStar:"ReactionSumStar_reactionSumStar__G5a3y"}}},function(e){e.O(0,[96,774,888,179],(function(){return n=8312,e(e.s=n);var n}));var n=e.O();_N_E=n}]);